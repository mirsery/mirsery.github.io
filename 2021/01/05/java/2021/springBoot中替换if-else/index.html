<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Springboot 中干掉if else · mirsery</title><meta name="description" content="Springboot 中干掉if else - mirsery"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="stylesheet" href="/css/dracula.css"><link rel="search" type="application/opensearchdescription+xml" href="https://mirsery.github.io/atom.xml" title="mirsery"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="mirsery" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">mirsery</h2></a></div><a class="li component-nav-item" href="/" target="_self"><p>首页</p></a><a class="li component-nav-item" href="/archives" target="_self"><p>归档</p></a><a class="li component-nav-item" href="/categories" target="_self"><p>分类</p></a><a class="li component-nav-item" href="/tags" target="_self"><p>标签</p></a><ul class="shortcut-icons"><a href="https://github.com/mirsery" target="_blank"><img class="icon" src="/images/github.svg"></a><a href="/atom.xml" target="_blank"><img class="icon" src="/images/rss.svg"></a><a href="https://www.zhihu.com/people/mirsery" target="_blank"><img class="icon" src="/images/zhihu.svg"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post article post-block"><h1 class="post-title">Springboot 中干掉if else</h1><div class="post-info">2021年1月6日</div><div class="post-content"><h1 id="Springboot-中干掉if-else"><a href="#Springboot-中干掉if-else" class="headerlink" title="Springboot 中干掉if else"></a>Springboot 中干掉if else</h1><blockquote>
<p> 来自：掘金（作者：cipher）<br>原文链接 <a target="_blank" rel="noopener" href="https://juejin.im/post/5c551122e51d457fcc5a9790">https://juejin.im/post/5c551122e51d457fcc5a9790</a></p>
</blockquote>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>这里虚拟一个业务需求，让大家容易理解。假设有一个订单系统，里面的一个功能是根据订单的不同类型作出不同的处理。<br>订单实体:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderDTO</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String code;<br>    <span class="hljs-keyword">private</span> BigDecimal price;<br>    <span class="hljs-keyword">private</span> String type;  <br>&#125;<br></code></pre></td></tr></table></figure>
<p>service接口:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">IOrderService</span> </span>&#123;<br>            <span class="hljs-comment">/**</span><br><span class="hljs-comment">            * 根据订单的不同类型做出不同的处理</span><br><span class="hljs-comment">            * <span class="hljs-doctag">@param</span> dto 订单实体</span><br><span class="hljs-comment">            * <span class="hljs-doctag">@return</span> </span><br><span class="hljs-comment">            */</span><br>            <span class="hljs-function">String <span class="hljs-title">handle</span><span class="hljs-params">(OrderDTO dto)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>##传统实现<br>根据订单类写一堆的if-else:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">IOrderService</span> </span>&#123;<br>    String type = dto.getType();<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;1&quot;</span>.equals(type))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;处理普通订单&quot;</span>;<br>        &#125;<span class="hljs-function">elese <span class="hljs-title">if</span><span class="hljs-params">(<span class="hljs-string">&quot;2&quot;</span>.equals(type)</span>)</span>&#123;<br>           <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;处理团购订单&quot;</span>;<br>       &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">&quot;3&quot;</span>.equals(type))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;处理促销订单&quot;</span>;<br>      &#125;                <br>     <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="策略模式实现"><a href="#策略模式实现" class="headerlink" title="策略模式实现"></a>策略模式实现</h2><p>利用策略模式只需要实现两行可实现业务逻辑:<br>@Service<br>public class OrderServiceV2Impl implements IOrderService {<br>    @Autowrited<br>    private HandlerContext handlerContext;</p>
<pre><code>@Override
public String handle(OrderDTO dto)&#123;
    AbstractHandler handler = handlerContext.getInstance(dto.getType());
    return handler.handle(dto);
</code></pre>
<p>   }<br>}<br>可以看到上面的方法中注入了HandlerContext，这是一个处理器上下文，用来保存不同的业务处理器，具体在下文会讲解。我们从中获取一个抽象的处理器AbstractHandler，调用其方法实现业务逻辑。<br>现在可以了解到，我们主要的业务逻辑是在处理器中实现的，因此有多少个订单类型，就对应有多少个处理器。以后需求变化，增加了订单类型，只需要添加相应的处理器就可以，上述OrderServiceV2Impl完全不需改动。</p>
<hr>
<p>以上是转自网友 cipher 的文章,今天突然发现springboot可以注入同一接口实现的services集合就想到可以利用其value属性实现策略模式.<br>修改时间 2021-01-06 23:51:58</p>
<pre><code>其实在springboot中实现策略模式，我们可以利用springboot本身提供的@service 注解以及其 同一接口的实现的Map注入就可以解决。下面简单的举个例子。
</code></pre>
<p>首先我们先定一个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">DataListener</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onData</span><span class="hljs-params">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>接着定义几个实现该接口的类 DataListener1, DataListener2.<br>我们在实现的类DataListener1…上增加@service注解，同时给他命名（其默认名可以为字符串类型的策略），接着我们定义一个场景类<strong>DataHandleContext</strong>,<br>场景类中引入如下变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowrite</span><br><span class="hljs-keyword">public</span> Map&lt;String,DataListener&gt; dataListenerMap;<span class="hljs-comment">//该类是所定义的策略的map集合</span><br></code></pre></td></tr></table></figure>
<p>至此，我们就很简单的实现了策略模式。策略的命名可以采用枚举类进行控制，这样新增策略时只需要在枚举类中新增相应的枚举类型以及新建相关的service层类。</p>
</div></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'mirsery';
var disqus_identifier = '2021/01/05/java/2021/springBoot中替换if-else/';
var disqus_title = 'Springboot 中干掉if else';
var disqus_url = 'https://mirsery.github.io/2021/01/05/java/2021/springBoot中替换if-else/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a class="prev" href="/2021/01/05/java/2021/Java%20NIO%20SelectionKey/">上一篇</a><a class="next" href="/2020/10/10/IDE/IDEA%20%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E9%97%AE%E9%A2%98/">下一篇</a></div><div class="copyright"><p>© 2015 - 2021 <a href="https://mirsery.github.io">mirsery</a> </p><p>powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and  <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a></p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"mirsery",'auto');ga('send','pageview');</script></body></html>