<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> （转）linux下的sudoers配置 · mirsery</title><meta name="description" content="（转）linux下的sudoers配置 - mirsery"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="stylesheet" href="/css/dracula.css"><link rel="search" type="application/opensearchdescription+xml" href="https://mirsery.github.io/atom.xml" title="mirsery"><meta name="generator" content="Hexo 6.0.0"><link rel="alternate" href="/atom.xml" title="mirsery" type="application/atom+xml">
</head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">mirsery</h2></a></div><a class="li component-nav-item" href="/" target="_self"><p>首页</p></a><a class="li component-nav-item" href="/archives" target="_self"><p>归档</p></a><a class="li component-nav-item" href="/categories" target="_self"><p>分类</p></a><a class="li component-nav-item" href="/tags" target="_self"><p>标签</p></a><ul class="shortcut-icons"><a href="https://github.com/mirsery" target="_blank"><img class="icon" src="/images/github.svg"></a><a href="/atom.xml" target="_blank"><img class="icon" src="/images/rss.svg"></a><a href="https://www.zhihu.com/people/mirsery" target="_blank"><img class="icon" src="/images/zhihu.svg"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post article post-block"><h1 class="post-title">（转）linux下的sudoers配置</h1><div class="post-info">作者: mirsery         创建日期: 2016年8月10日</div><div class="post-content"><blockquote>
<p><a target="_blank" rel="noopener" href="http://www.osedu.net/article/linux/2011-01-03/178.html">原文地址</a></p>
</blockquote>
<p>Linux下的sudo及其配置文件/etc/sudoers的详细配置说明</p>
<h1 id="1-sudo介绍"><a href="#1-sudo介绍" class="headerlink" title="1.sudo介绍"></a>1.sudo介绍</h1><p>sudo是linux下常用的允许普通用户使用超级用户权限的工具，允许系统管理员让普通用户执行一些或者全部的root命令，如halt，reboot，su等等。这样不仅减少了root用户的登陆 和管理时间，同样也提高了安全性。Sudo不是对shell的一个代替，它是面向每个命令的。<br>它的特性主要有这样几点：</p>
<ul>
<li>sudo能够限制用户只在某台主机上运行某些命令。</li>
<li>sudo提供了丰富的日志，详细地记录了每个用户干了什么。它能够将日志传到中心主机或者日志服务器。</li>
<li>sudo使用时间戳文件来执行类似的“检票”系统。当用户调用sudo并且输入它的密码时，用户获得了一张存活期为5分钟的票（这个值可以在编译的时候改变）。</li>
<li>sudo的配置文件是sudoers文件，它允许系统管理员集中的管理用户的使用权限和使用的主机。它所存放的位置默认是在/etc/sudoers，属性必须为0411。</li>
</ul>
<h1 id="2-配置文件-etc-sudoers"><a href="#2-配置文件-etc-sudoers" class="headerlink" title="2.配置文件/etc/sudoers"></a>2.配置文件/etc/sudoers</h1><p>它的主要配置文件是sudoers,linux下通常在/etc目录下，如果是solaris，缺省不装sudo的，编译安装后通常在安装目录的 etc目录下，不过不管sudoers文件在哪儿，sudo都提供了一个编辑该文件的命令：visudo来对该文件进行修改。强烈推荐使用该命令修改 sudoers，因为它会帮你校验文件配置是否正确，如果不正确，在保存退出时就会提示你哪段配置出错的。 </p>
<p>言归正传，下面介绍如何配置sudoers:<br>首先写sudoers的缺省配置： </p>
<pre><code class="highlight plaintext">############################################################# 
# sudoers file. 
# 
# This file MUST be edited with the &#x27;visudo&#x27; command as root. 
# 
# See the sudoers man page for the details on how to write a sudoers file. 
# 

# Host alias specification 

# User alias specification 

# Cmnd alias specification 

# Defaults specification 

# User privilege specification 
    root    ALL=(ALL) ALL 

# Uncomment to allow people in group wheel to run all commands 
# %wheel        ALL=(ALL)       ALL 

# Same thing without a password 
# %wheel        ALL=(ALL)       NOPASSWD: ALL 

# Samples 
# %users  ALL=/sbin/mount /cdrom,/sbin/umount /cdrom 
# %users  localhost=/sbin/shutdown -h now 
##################################################################</code></pre>
<p>##1. 最简单的配置，让普通用户support具有root的所有权限<br>执行visudo之后，可以看见缺省只有一条配置：<br>   <code>root    ALL=(ALL) ALL</code><br>那么你就在下边再加一条配置：<br>    <code>support ALL=(ALL) ALL </code><br>这样，普通用户support就能够执行root权限的所有命令<br>以support用户登录之后，执行：<br>    <code>sudo su - </code><br>然后输入support用户自己的密码，就可以切换成root用户了<br>##2. 让普通用户support只能在某几台服务器上，执行root能执行的某些命令<br>首先需要配置一些Alias，这样在下面配置权限时，会方便一些，不用写大段大段的配置。Alias主要分成4种 </p>
<ul>
<li>配置Host_Alias：就是主机的列表<br>  <code>Host_Alias      HOST_FLAG = hostname1, hostname2, hostname3 </code></li>
<li>配置Cmnd_Alias：就是允许执行的命令的列表<br>  <code>Cmnd_Alias      COMMAND_FLAG = command1, command2, command3 </code></li>
<li>配置User_Alias：就是具有sudo权限的用户的列表<br>  <code>User_Alias USER_FLAG = user1, user2, user3 </code></li>
<li>配置Runas_Alias：就是用户以什么身份执行（例如root，或者oracle）的列表<br> <code>Runas_Alias RUNAS_FLAG = operator1, operator2, operator3</code></li>
<li>配置权限<br>  配置权限的格式如下： <pre><code> ``` USER_FLAG HOST_FLAG=(RUNAS_FLAG) COMMAND_FLAG ```
</code></pre>
  如果不需要密码验证的话，则按照这样的格式来配置 <pre><code> ``` USER_FLAG HOST_FLAG=(RUNAS_FLAG) NOPASSWD: COMMAND_FLAG ```
</code></pre>
</li>
<li>配置示例：<pre><code class="highlight plaintext">############################################################################ 
# sudoers file. 
# 
# This file MUST be edited with the &#x27;visudo&#x27; command as root. 
# 
# See the sudoers man page for the details on how to write a sudoers file. 
# 

# Host alias specification 
Host_Alias      EPG = 192.168.1.1, 192.168.1.2 

# User alias specification 

# Cmnd alias specification 
Cmnd_Alias      SQUID = /opt/vtbin/squid_refresh, /sbin/service, /bin/rm 

# Defaults specification 

# User privilege specification 
root    ALL=(ALL) ALL 
support EPG=(ALL) NOPASSWD: SQUID 

# Uncomment to allow people in group wheel to run all commands 
# %wheel        ALL=(ALL)       ALL 

# Same thing without a password 
# %wheel        ALL=(ALL)       NOPASSWD: ALL 

# Samples 
# %users  ALL=/sbin/mount /cdrom,/sbin/umount /cdrom 
# %users  localhost=/sbin/shutdown -h now 
###############################################################</code></pre></li>
</ul>
</div></div><div id="disqus_thread"></div></div><script>var disqus_shortname = 'mirsery';
var disqus_identifier = '2016/08/10/linux/（转）linux下的sudoers配置/';
var disqus_title = '（转）linux下的sudoers配置';
var disqus_url = 'https://mirsery.github.io/2016/08/10/linux/（转）linux下的sudoers配置/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a class="prev" href="/2016/08/12/%E7%BC%96%E7%A0%81%E8%A7%84%E8%8C%83/jQuery%E7%9A%84%E7%BC%96%E7%A0%81%E6%A0%87%E5%87%86/">上一篇</a><a class="next" href="/2016/08/10/linux/linux%E4%B8%8B%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7/">下一篇</a></div><div class="copyright"><p>© 2015 - 2022 <a href="https://mirsery.github.io">mirsery</a> </p><p>powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and  <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a></p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"mirsery",'auto');ga('send','pageview');</script></body></html>